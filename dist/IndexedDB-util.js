!function(e,o){"function"==typeof define&&define.amd?define([],o):"object"==typeof exports?module.exports=o():e.IndexedDB=o()}(this,function(){var e=function(e){var o;if(e.keyNames){o=e.keyNames;for(var n=0;n<o.length;n++)o[n].unique||(o[n].unique=!1)}this.dbName=e.dbName,this.version=e.version,this.primaryKey=e.primaryKey||"id",this.keyNames=e.keyNames,this.db=null,this.allData=[]};return e.prototype={init:function(){var o=this,n=o.dbName,e=o.version,r=o.primaryKey,a=o.keyNames;if(!(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB))return window.alert("您的浏览器不支持当前内容"),!1;if(!n)return window.alert("数据库名称不能为空"),!1;var t=window.indexedDB.open(n,e);t.onsuccess=function(e){o.db=t.result},t.onerror=function(e){window.alert("数据库打开失败")},t.onupgradeneeded=function(e){if(o.db=e.target.result,o.db.onerror=function(e){window.alert("数据库打开失败")},!o.db.objectStoreNames.contains(n))var t=o.db.createObjectStore(n,{keyPath:r,autoIncrement:!0});a.forEach(function(e,o,n){t.createIndex(e.key,e.key,{unique:e.unique||!1})})}},set:function(e){var o=this,n=o.dbName,t=(o.version,o.db),r=(o.primaryKey,o.keyNames,t.transaction([n],"readwrite")),a=r.objectStore(n);if(Array.isArray(e))for(var i=0;i<e.length;i++)a.add(e[i]).onsuccess=function(e){console.log("数据写入成功")},r.onerror=function(e){console.log("数据库中已有该数据")};else a.add(e).onsuccess=function(e){console.log("数据写入成功")},r.onerror=function(e){console.log("数据库中已有该数据")}},updateData:function(e){var o=this.dbName,n=this.db.transaction([o],"readwrite"),t=n.objectStore(o);if(Array.isArray(e))for(var r=0;r<e.length;r++)t.put(e[r]).onsuccess=function(e){console.log("数据更新成功")},n.onerror=function(e){console.log("数据更新成功")};else t.put(e).onsuccess=function(e){console.log("数据更新成功")},n.onerror=function(e){console.log("数据更新成功")}},getAllData:function(){var n=this,e=n.dbName;return n.allData=[],n.db.transaction(e).objectStore(e).openCursor().onsuccess=function(e){var o=e.target.result;o&&(console.log(o.value),n.allData.push(o.value),o.continue())},n.allData},getData:function(e){var o=this.dbName,n=this.db.transaction(o).objectStore(o).get(e);n.onerror=function(e){console.log("获取失败")},n.onsuccess=function(e){if(n.result)return console.log(n.result),n.result;console.log("未获得数据记录")}},deleteDB:function(){var e=this.dbName;window.indexedDB.deleteDatabase(e),console.log(e+"数据库已删除")},closeDB:function(){this.db.close(),console.log("数据库已关闭")},deleteData:function(e){var o=this.dbName;this.db.transaction(o,"readwrite").objectStore(o).delete(e).onsuccess=function(e){console.log("删除成功")}},clearData:function(){var e=this.dbName;this.db.transaction(e,"readwrite").objectStore(e).clear(),console.log("已删除存储空间"+e+"全部记录")},searchData:function(e,o){var n=this.dbName,t=this.db.transaction(n,"readonly").objectStore(n).index(e).get(o);t.onerror=function(){return console.error("搜索出错"),!1},t.onsuccess=function(e){var o=e.target.result;return o?(console.log(o),o):(console.log("您搜索的数据不存在"),!1)}}},e});